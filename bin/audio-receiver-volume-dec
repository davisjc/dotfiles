#!/bin/sh

VOLUME_DAT=$HOME/.receiver_volume.dat
LOCK_DIR=$HOME/.receiver_volume.lock

VOLUME_STEP=-15

if (mkdir $LOCK_DIR 2> /dev/null); then
    # Retrieve stored volume level.
    VOLUME_LEVEL=$(cat $VOLUME_DAT)

    # Determine new volume level.
    VOLUME_LEVEL=$(expr $VOLUME_LEVEL + $VOLUME_STEP)

    # Store volume level.
    echo $VOLUME_LEVEL > $VOLUME_DAT

    # Request new volume level.
    curl -X POST -H "Content-Type: text/xml" -d "<YAMAHA_AV cmd=\"PUT\"><Zone_2><Volume><Lvl><Val>${VOLUME_LEVEL}</Val><Exp>1</Exp><Unit>dB</Unit></Lvl></Volume></Zone_2></YAMAHA_AV>" http://yamaha/YamahaRemoteControl/ctrl

    i3_update_volume

    # Release lock.
    rm -r $LOCK_DIR
fi

